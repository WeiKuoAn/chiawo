/*!
 * ClockPicker v0.0.7 (http://weareoutman.github.io/clockpicker/)
 * Copyright 2014 Wang Shenwei.
 * Licensed under MIT (https://github.com/weareoutman/clockpicker/blob/gh-pages/LICENSE)
 */(function(){function V(t){return document.createElementNS(tt,t)}function T(t){return(10>t?"0":"")+t}function at(t){var i=++pt+"";return t?t+i:i}function k(t,i){function o(w,Z){var ot=e.offset(),ct=/^touch/.test(w.type),_=ot.left+d,$=ot.top+d,E=(ct?w.originalEvent.touches[0]:w).pageX-_,D=(ct?w.originalEvent.touches[0]:w).pageY-$,nt=Math.sqrt(E*E+D*D),W=!1;if(!Z||!(f-m>nt||nt>f+m)){w.preventDefault();var lt=setTimeout(function(){R.addClass("clockpicker-moving")},200);O&&e.append(l.canvas),l.setHand(E,D,!Z,!0),y.off(K).on(K,function(u){u.preventDefault();var I=/^touch/.test(u.type),B=(I?u.originalEvent.touches[0]:u).pageX-_,z=(I?u.originalEvent.touches[0]:u).pageY-$;(W||B!==E||z!==D)&&(W=!0,l.setHand(B,z,!1,!0))}),y.off(L).on(L,function(u){y.off(L),u.preventDefault();var I=/^touch/.test(u.type),B=(I?u.originalEvent.changedTouches[0]:u).pageX-_,z=(I?u.originalEvent.changedTouches[0]:u).pageY-$;(Z||W)&&B===E&&z===D&&l.setHand(B,z),l.currentView==="hours"?l.toggleView("minutes",N/2):i.autoclose&&(l.minutesView.addClass("clockpicker-dial-out"),setTimeout(function(){l.done()},N/2)),e.prepend(Y),clearTimeout(lt),R.removeClass("clockpicker-moving"),y.off(K)})}}var s=c(ht),e=s.find(".clockpicker-plate"),r=s.find(".clockpicker-hours"),h=s.find(".clockpicker-minutes"),p=s.find(".clockpicker-am-pm-block"),M=t.prop("tagName")==="INPUT",b=M?t:t.find("input"),P=t.find(".input-group-addon"),l=this;if(this.id=at("cp"),this.element=t,this.options=i,this.isAppended=!1,this.isShown=!1,this.currentView="hours",this.isInput=M,this.input=b,this.addon=P,this.popover=s,this.plate=e,this.hoursView=r,this.minutesView=h,this.amPmBlock=p,this.spanHours=s.find(".clockpicker-span-hours"),this.spanMinutes=s.find(".clockpicker-span-minutes"),this.spanAmPm=s.find(".clockpicker-span-am-pm"),this.amOrPm="PM",i.twelvehour){{var x=['<div class="clockpicker-am-pm-block">','<button type="button" class="btn btn-sm btn-default clockpicker-button clockpicker-am-button">',"AM</button>",'<button type="button" class="btn btn-sm btn-default clockpicker-button clockpicker-pm-button">',"PM</button>","</div>"].join("");c(x)}c('<button type="button" class="btn btn-sm btn-default clockpicker-button am-button">AM</button>').on("click",function(){l.amOrPm="AM",c(".clockpicker-span-am-pm").empty().append("AM")}).appendTo(this.amPmBlock),c('<button type="button" class="btn btn-sm btn-default clockpicker-button pm-button">PM</button>').on("click",function(){l.amOrPm="PM",c(".clockpicker-span-am-pm").empty().append("PM")}).appendTo(this.amPmBlock)}i.autoclose||c('<button type="button" class="btn btn-sm btn-default btn-block clockpicker-button">'+i.donetext+"</button>").click(c.proxy(this.done,this)).appendTo(s),i.placement!=="top"&&i.placement!=="bottom"||i.align!=="top"&&i.align!=="bottom"||(i.align="left"),i.placement!=="left"&&i.placement!=="right"||i.align!=="left"&&i.align!=="right"||(i.align="top"),s.addClass(i.placement),s.addClass("clockpicker-align-"+i.align),this.spanHours.click(c.proxy(this.toggleView,this,"hours")),this.spanMinutes.click(c.proxy(this.toggleView,this,"minutes")),b.on("focus.clockpicker click.clockpicker",c.proxy(this.show,this)),P.on("click.clockpicker",c.proxy(this.toggle,this));var n,a,g,C,X=c('<div class="clockpicker-tick"></div>');if(i.twelvehour)for(n=1;13>n;n+=1)a=X.clone(),g=n/6*Math.PI,C=f,a.css("font-size","120%"),a.css({left:d+Math.sin(g)*C-m,top:d-Math.cos(g)*C-m}),a.html(n===0?"00":n),r.append(a),a.on(j,o);else for(n=0;24>n;n+=1){a=X.clone(),g=n/6*Math.PI;var st=n>0&&13>n;C=st?q:f,a.css({left:d+Math.sin(g)*C-m,top:d-Math.cos(g)*C-m}),st&&a.css("font-size","120%"),a.html(n===0?"00":n),r.append(a),a.on(j,o)}for(n=0;60>n;n+=5)a=X.clone(),g=n/30*Math.PI,a.css({left:d+Math.sin(g)*f-m,top:d-Math.cos(g)*f-m}),a.css("font-size","120%"),a.html(T(n)),h.append(a),a.on(j,o);if(e.on(j,function(w){c(w.target).closest(".clockpicker-tick").length===0&&o(w,!0)}),O){var Y=s.find(".clockpicker-canvas"),S=V("svg");S.setAttribute("class","clockpicker-svg"),S.setAttribute("width",et),S.setAttribute("height",et);var A=V("g");A.setAttribute("transform","translate("+d+","+d+")");var H=V("circle");H.setAttribute("class","clockpicker-canvas-bearing"),H.setAttribute("cx",0),H.setAttribute("cy",0),H.setAttribute("r",2);var F=V("line");F.setAttribute("x1",0),F.setAttribute("y1",0);var G=V("circle");G.setAttribute("class","clockpicker-canvas-bg"),G.setAttribute("r",m);var Q=V("circle");Q.setAttribute("class","clockpicker-canvas-fg"),Q.setAttribute("r",3.5),A.appendChild(F),A.appendChild(G),A.appendChild(Q),A.appendChild(H),S.appendChild(A),Y.append(S),this.hand=F,this.bg=G,this.fg=Q,this.bearing=H,this.g=A,this.canvas=Y}v(this.options.init)}function v(t){t&&typeof t=="function"&&t()}var R,c=window.jQuery,U=c(window),y=c(document),tt="http://www.w3.org/2000/svg",O="SVGAngle"in window&&function(){var t,i=document.createElement("div");return i.innerHTML="<svg/>",t=(i.firstChild&&i.firstChild.namespaceURI)==tt,i.innerHTML="",t}(),rt=function(){var t=document.createElement("div").style;return"transition"in t||"WebkitTransition"in t||"MozTransition"in t||"msTransition"in t||"OTransition"in t}(),J="ontouchstart"in window,j="mousedown"+(J?" touchstart":""),K="mousemove.clockpicker"+(J?" touchmove.clockpicker":""),L="mouseup.clockpicker"+(J?" touchend.clockpicker":""),it=navigator.vibrate?"vibrate":navigator.webkitVibrate?"webkitVibrate":null,pt=0,d=100,f=80,q=54,m=13,et=2*d,N=rt?350:1,ht=['<div class="popover clockpicker-popover">','<div class="arrow"></div>','<div class="popover-title">','<span class="clockpicker-span-hours text-primary"></span>'," : ",'<span class="clockpicker-span-minutes"></span>','<span class="clockpicker-span-am-pm"></span>',"</div>",'<div class="popover-content">','<div class="clockpicker-plate">','<div class="clockpicker-canvas"></div>','<div class="clockpicker-dial clockpicker-hours"></div>','<div class="clockpicker-dial clockpicker-minutes clockpicker-dial-out"></div>',"</div>",'<span class="clockpicker-am-pm-block">',"</span>","</div>","</div>"].join("");k.DEFAULTS={default:"",fromnow:0,placement:"bottom",align:"left",donetext:"完成",autoclose:!1,twelvehour:!1,vibrate:!0},k.prototype.toggle=function(){this[this.isShown?"hide":"show"]()},k.prototype.locate=function(){var t=this.element,i=this.popover,o=t.offset(),s=t.outerWidth(),e=t.outerHeight(),r=this.options.placement,h=this.options.align,p={};switch(i.show(),r){case"bottom":p.top=o.top+e;break;case"right":p.left=o.left+s;break;case"top":p.top=o.top-i.outerHeight();break;case"left":p.left=o.left-i.outerWidth()}switch(h){case"left":p.left=o.left;break;case"right":p.left=o.left+s-i.outerWidth();break;case"top":p.top=o.top;break;case"bottom":p.top=o.top+e-i.outerHeight()}i.css(p)},k.prototype.show=function(){if(!this.isShown){v(this.options.beforeShow);var t=this;this.isAppended||(R=c(document.body).append(this.popover),U.on("resize.clockpicker"+this.id,function(){t.isShown&&t.locate()}),this.isAppended=!0);var i=((this.input.prop("value")||this.options.default||"")+"").split(":");if(i[0]==="now"){var o=new Date(+new Date+this.options.fromnow);i=[o.getHours(),o.getMinutes()]}this.hours=+i[0]||0,this.minutes=+i[1]||0,this.spanHours.html(T(this.hours)),this.spanMinutes.html(T(this.minutes)),this.toggleView("hours"),this.locate(),this.isShown=!0,y.on("click.clockpicker."+this.id+" focusin.clockpicker."+this.id,function(s){var e=c(s.target);e.closest(t.popover).length===0&&e.closest(t.addon).length===0&&e.closest(t.input).length===0&&t.hide()}),y.on("keyup.clockpicker."+this.id,function(s){s.keyCode===27&&t.hide()}),v(this.options.afterShow)}},k.prototype.hide=function(){v(this.options.beforeHide),this.isShown=!1,y.off("click.clockpicker."+this.id+" focusin.clockpicker."+this.id),y.off("keyup.clockpicker."+this.id),this.popover.hide(),v(this.options.afterHide)},k.prototype.toggleView=function(t,i){var o=!1;t==="minutes"&&c(this.hoursView).css("visibility")==="visible"&&(v(this.options.beforeHourSelect),o=!0);var s=t==="hours",e=s?this.hoursView:this.minutesView,r=s?this.minutesView:this.hoursView;this.currentView=t,this.spanHours.toggleClass("text-primary",s),this.spanMinutes.toggleClass("text-primary",!s),r.addClass("clockpicker-dial-out"),e.css("visibility","visible").removeClass("clockpicker-dial-out"),this.resetClock(i),clearTimeout(this.toggleViewTimer),this.toggleViewTimer=setTimeout(function(){r.css("visibility","hidden")},N),o&&v(this.options.afterHourSelect)},k.prototype.resetClock=function(t){var i=this.currentView,o=this[i],s=i==="hours",e=Math.PI/(s?6:30),r=o*e,h=s&&o>0&&13>o?q:f,p=Math.sin(r)*h,M=-Math.cos(r)*h,b=this;O&&t?(b.canvas.addClass("clockpicker-canvas-out"),setTimeout(function(){b.canvas.removeClass("clockpicker-canvas-out"),b.setHand(p,M)},t)):this.setHand(p,M)},k.prototype.setHand=function(t,i,o,s){var e,r=Math.atan2(t,-i),h=this.currentView==="hours",p=Math.PI/(h||o?6:30),M=Math.sqrt(t*t+i*i),b=this.options,P=h&&(f+q)/2>M,l=P?q:f;if(b.twelvehour&&(l=f),0>r&&(r=2*Math.PI+r),e=Math.round(r/p),r=e*p,b.twelvehour?h?e===0&&(e=12):(o&&(e*=5),e===60&&(e=0)):h?(e===12&&(e=0),e=P?e===0?12:e:e===0?0:e+12):(o&&(e*=5),e===60&&(e=0)),this[this.currentView]!==e&&it&&this.options.vibrate&&(this.vibrateTimer||(navigator[it](10),this.vibrateTimer=setTimeout(c.proxy(function(){this.vibrateTimer=null},this),100))),this[this.currentView]=e,this[h?"spanHours":"spanMinutes"].html(T(e)),!O)return void this[h?"hoursView":"minutesView"].find(".clockpicker-tick").each(function(){var a=c(this);a.toggleClass("active",e===+a.html())});s||!h&&e%5?(this.g.insertBefore(this.hand,this.bearing),this.g.insertBefore(this.bg,this.fg),this.bg.setAttribute("class","clockpicker-canvas-bg clockpicker-canvas-bg-trans")):(this.g.insertBefore(this.hand,this.bg),this.g.insertBefore(this.fg,this.bg),this.bg.setAttribute("class","clockpicker-canvas-bg"));var x=Math.sin(r)*l,n=-Math.cos(r)*l;this.hand.setAttribute("x2",x),this.hand.setAttribute("y2",n),this.bg.setAttribute("cx",x),this.bg.setAttribute("cy",n),this.fg.setAttribute("cx",x),this.fg.setAttribute("cy",n)},k.prototype.done=function(){v(this.options.beforeDone),this.hide();var t=this.input.prop("value"),i=T(this.hours)+":"+T(this.minutes);this.options.twelvehour&&(i+=this.amOrPm),this.input.prop("value",i),i!==t&&(this.input.triggerHandler("change"),this.isInput||this.element.trigger("change")),this.options.autoclose&&this.input.trigger("blur"),v(this.options.afterDone)},k.prototype.remove=function(){this.element.removeData("clockpicker"),this.input.off("focus.clockpicker click.clockpicker"),this.addon.off("click.clockpicker"),this.isShown&&this.hide(),this.isAppended&&(U.off("resize.clockpicker"+this.id),this.popover.remove())},c.fn.clockpicker=function(t){var i=Array.prototype.slice.call(arguments,1);return this.each(function(){var o=c(this),s=o.data("clockpicker");if(s)typeof s[t]=="function"&&s[t].apply(s,i);else{var e=c.extend({},k.DEFAULTS,o.data(),typeof t=="object"&&t);o.data("clockpicker",new k(o,e))}})}})();
