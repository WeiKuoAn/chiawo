(function(d,i,c){function l(t,e){var n=i(t);n.data(s,this),this._container=n,this.data=[],this.fields=[],this._editingRow=null,this._sortField=null,this._sortOrder=p,this._firstDisplayingPage=1,this._init(e),this.render()}var r="JSGrid",s=r,h="JSGridItem",o="JSGridEditRow",p="asc",f="desc",v="{first}",C="{pages}",m="{prev}",y="{next}",x="{last}",R="{pageIndex}",D="{pageCount}",E="{itemCount}",k="javascript:void(0);",w=function(t,e){return i.isFunction(t)?t.apply(e,i.makeArray(arguments).slice(2)):t},N=function(t){var e=i.Deferred();return t&&t.then?t.then(function(){e.resolve.apply(e,arguments)},function(){e.reject.apply(e,arguments)}):e.resolve(t),e.promise()},T={loadData:i.noop,insertItem:i.noop,updateItem:i.noop,deleteItem:i.noop};l.prototype={width:"auto",height:"auto",updateOnResize:!0,rowClass:i.noop,rowRenderer:null,rowClick:function(t){this.editing&&this.editItem(i(t.event.target).closest("tr"))},rowDoubleClick:i.noop,noDataContent:"Not found",noDataRowClass:"jsgrid-nodata-row",heading:!0,headerRowRenderer:null,headerRowClass:"jsgrid-header-row",headerCellClass:"jsgrid-header-cell",filtering:!1,filterRowRenderer:null,filterRowClass:"jsgrid-filter-row",inserting:!1,insertRowRenderer:null,insertRowClass:"jsgrid-insert-row",editing:!1,editRowRenderer:null,editRowClass:"jsgrid-edit-row",confirmDeleting:!0,deleteConfirm:"Are you sure?",selecting:!0,selectedRowClass:"jsgrid-selected-row",oddRowClass:"jsgrid-row",evenRowClass:"jsgrid-alt-row",cellClass:"jsgrid-cell",sorting:!1,sortableClass:"jsgrid-header-sortable",sortAscClass:"jsgrid-header-sort jsgrid-header-sort-asc",sortDescClass:"jsgrid-header-sort jsgrid-header-sort-desc",paging:!1,pagerContainer:null,pageIndex:1,pageSize:20,pageButtonCount:15,pagerFormat:"Pages: {first} {prev} {pages} {next} {last} &nbsp;&nbsp; {pageIndex} of {pageCount}",pagePrevText:"Prev",pageNextText:"Next",pageFirstText:"First",pageLastText:"Last",pageNavigatorNextText:"...",pageNavigatorPrevText:"...",pagerContainerClass:"jsgrid-pager-container",pagerClass:"jsgrid-pager",pagerNavButtonClass:"jsgrid-pager-nav-button",pagerNavButtonInactiveClass:"jsgrid-pager-nav-inactive-button",pageClass:"jsgrid-pager-page",currentPageClass:"jsgrid-pager-current-page",customLoading:!1,pageLoading:!1,autoload:!1,controller:T,loadIndication:!0,loadIndicationDelay:500,loadMessage:"Please, wait...",loadShading:!0,invalidMessage:"Invalid data entered!",invalidNotify:function(t){var e=i.map(t.errors,function(n){return n.message||null});d.alert([this.invalidMessage].concat(e).join(`
`))},onInit:i.noop,onRefreshing:i.noop,onRefreshed:i.noop,onPageChanged:i.noop,onItemDeleting:i.noop,onItemDeleted:i.noop,onItemInserting:i.noop,onItemInserted:i.noop,onItemEditing:i.noop,onItemUpdating:i.noop,onItemUpdated:i.noop,onItemInvalid:i.noop,onDataLoading:i.noop,onDataLoaded:i.noop,onOptionChanging:i.noop,onOptionChanged:i.noop,onError:i.noop,invalidClass:"jsgrid-invalid",containerClass:"jsgrid",tableClass:"jsgrid-table",gridHeaderClass:"jsgrid-grid-header",gridBodyClass:"jsgrid-grid-body",_init:function(t){i.extend(this,t),this._initLoadStrategy(),this._initController(),this._initFields(),this._attachWindowLoadResize(),this._attachWindowResizeCallback(),this._callEventHandler(this.onInit)},loadStrategy:function(){return this.pageLoading?new jsGrid.loadStrategies.PageLoadingStrategy(this):new jsGrid.loadStrategies.DirectLoadingStrategy(this)},_initLoadStrategy:function(){this._loadStrategy=w(this.loadStrategy,this)},_initController:function(){this._controller=i.extend({},T,w(this.controller,this))},renderTemplate:function(t,e,n){let a=[];for(var u in n)a.push(n[u]);return a.unshift(t,e),t=w.apply(null,a),t===c||t===null?"":t},loadIndicator:function(t){return new jsGrid.LoadIndicator(t)},validation:function(t){return jsGrid.Validation&&new jsGrid.Validation(t)},_initFields:function(){var t=this;t.fields=i.map(t.fields,function(e){if(i.isPlainObject(e)){var n=e.type&&jsGrid.fields[e.type]||jsGrid.Field;e=new n(e)}return e._grid=t,e})},_attachWindowLoadResize:function(){i(d).on("load",i.proxy(this._refreshSize,this))},_attachWindowResizeCallback:function(){this.updateOnResize&&i(d).on("resize",i.proxy(this._refreshSize,this))},_detachWindowResizeCallback:function(){i(d).off("resize",this._refreshSize)},option:function(t,e){var n,a;return arguments.length===1?this[t]:(n={option:t,oldValue:this[t],newValue:e},this._callEventHandler(this.onOptionChanging,n),this._handleOptionChange(n.option,n.newValue),a={option:n.option,value:n.newValue},void this._callEventHandler(this.onOptionChanged,a))},fieldOption:function(t,e,n){return t=this._normalizeField(t),arguments.length===2?t[e]:(t[e]=n,void this._renderGrid())},_handleOptionChange:function(t,e){switch(this[t]=e,t){case"width":case"height":this._refreshSize();break;case"rowClass":case"rowRenderer":case"rowClick":case"rowDoubleClick":case"noDataRowClass":case"noDataContent":case"selecting":case"selectedRowClass":case"oddRowClass":case"evenRowClass":this._refreshContent();break;case"pageButtonCount":case"pagerFormat":case"pagePrevText":case"pageNextText":case"pageFirstText":case"pageLastText":case"pageNavigatorNextText":case"pageNavigatorPrevText":case"pagerClass":case"pagerNavButtonClass":case"pageClass":case"currentPageClass":case"pagerRenderer":this._refreshPager();break;case"fields":this._initFields(),this.render();break;case"data":case"editing":case"heading":case"filtering":case"inserting":case"paging":this.refresh();break;case"loadStrategy":case"pageLoading":this._initLoadStrategy(),this.search();break;case"pageIndex":this.openPage(e);break;case"pageSize":this.refresh(),this.search();break;case"editRowRenderer":case"editRowClass":this.cancelEdit();break;case"updateOnResize":this._detachWindowResizeCallback(),this._attachWindowResizeCallback();break;case"invalidNotify":case"invalidMessage":break;default:this.render()}},destroy:function(){this._detachWindowResizeCallback(),this._clear(),this._container.removeData(s)},render:function(){return this._renderGrid(),this.autoload?this.loadData():i.Deferred().resolve().promise()},_renderGrid:function(){this._clear(),this._container.addClass(this.containerClass).css("position","relative").append(this._createHeader()).append(this._createBody()),this._pagerContainer=this._createPagerContainer(),this._loadIndicator=this._createLoadIndicator(),this._validation=this._createValidation(),this.refresh()},_createLoadIndicator:function(){return w(this.loadIndicator,this,{message:this.loadMessage,shading:this.loadShading,container:this._container})},_createValidation:function(){return w(this.validation,this)},_clear:function(){this.cancelEdit(),clearTimeout(this._loadingTimer),this._pagerContainer&&this._pagerContainer.empty(),this._container.empty().css({position:"",width:"",height:""})},_createHeader:function(){var t=this._headerRow=this._createHeaderRow(),e=this._filterRow=this._createFilterRow(),n=this._insertRow=this._createInsertRow(),a=this._headerGrid=i("<table>").addClass(this.tableClass).append(t).append(e).append(n),u=this._header=i("<div>").addClass(this.gridHeaderClass).addClass(this._scrollBarWidth()?"jsgrid-header-scrollbar":"").append(a);return u},_createBody:function(){var t=this._content=i("<tbody>"),e=this._bodyGrid=i("<table>").addClass(this.tableClass).append(t),n=this._body=i("<div>").addClass(this.gridBodyClass).append(e).on("scroll",i.proxy(function(a){this._header.scrollLeft(a.target.scrollLeft)},this));return n},_createPagerContainer:function(){var t=this.pagerContainer||i("<div>").appendTo(this._container);return i(t).addClass(this.pagerContainerClass)},_eachField:function(t){var e=this;i.each(this.fields,function(n,a){a.visible&&t.call(e,a,n)})},_createHeaderRow:function(){if(i.isFunction(this.headerRowRenderer))return i(this.renderTemplate(this.headerRowRenderer,this));var t=i("<tr>").addClass(this.headerRowClass);return this._eachField(function(e,n){var a=this._prepareCell("<th>",e,"headercss",this.headerCellClass).append(this.renderTemplate(e.headerTemplate,e)).appendTo(t);this.sorting&&e.sorting&&a.addClass(this.sortableClass).on("click",i.proxy(function(){this.sort(n)},this))}),t},_prepareCell:function(t,e,n,a){return i(t).css("width",e.width).addClass(a||this.cellClass).addClass(n&&e[n]||e.css).addClass(e.align?"jsgrid-align-"+e.align:"")},_createFilterRow:function(){if(i.isFunction(this.filterRowRenderer))return i(this.renderTemplate(this.filterRowRenderer,this));var t=i("<tr>").addClass(this.filterRowClass);return this._eachField(function(e){this._prepareCell("<td>",e,"filtercss").append(this.renderTemplate(e.filterTemplate,e)).appendTo(t)}),t},_createInsertRow:function(){if(i.isFunction(this.insertRowRenderer))return i(this.renderTemplate(this.insertRowRenderer,this));var t=i("<tr>").addClass(this.insertRowClass);return this._eachField(function(e){this._prepareCell("<td>",e,"insertcss").append(this.renderTemplate(e.insertTemplate,e)).appendTo(t)}),t},_callEventHandler:function(t,e){return t.call(this,i.extend(e,{grid:this})),e},reset:function(){return this._resetSorting(),this._resetPager(),this._loadStrategy.reset()},_resetPager:function(){this._firstDisplayingPage=1,this._setPage(1)},_resetSorting:function(){this._sortField=null,this._sortOrder=p,this._clearSortingCss()},refresh:function(){this._callEventHandler(this.onRefreshing),this.cancelEdit(),this._refreshHeading(),this._refreshFiltering(),this._refreshInserting(),this._refreshContent(),this._refreshPager(),this._refreshSize(),this._callEventHandler(this.onRefreshed)},_refreshHeading:function(){this._headerRow.toggle(this.heading)},_refreshFiltering:function(){this._filterRow.toggle(this.filtering)},_refreshInserting:function(){this._insertRow.toggle(this.inserting)},_refreshContent:function(){var t=this._content;if(t.empty(),!this.data.length)return t.append(this._createNoDataRow()),this;for(var e=this._loadStrategy.firstDisplayIndex(),n=this._loadStrategy.lastDisplayIndex(),a=e;n>a;a++){var u=this.data[a];t.append(this._createRow(u,a))}},_createNoDataRow:function(){var t=0;return this._eachField(function(){t++}),i("<tr>").addClass(this.noDataRowClass).append(i("<td>").addClass(this.cellClass).attr("colspan",t).append(this.renderTemplate(this.noDataContent,this)))},_createRow:function(t,e){var n;return i.isFunction(this.rowRenderer)?n=this.renderTemplate(this.rowRenderer,this,{item:t,itemIndex:e}):(n=i("<tr>"),this._renderCells(n,t)),n.addClass(this._getRowClasses(t,e)).data(h,t).on("click",i.proxy(function(a){this.rowClick({item:t,itemIndex:e,event:a})},this)).on("dblclick",i.proxy(function(a){this.rowDoubleClick({item:t,itemIndex:e,event:a})},this)),this.selecting&&this._attachRowHover(n),n},_getRowClasses:function(t,e){var n=[];return n.push((e+1)%2?this.oddRowClass:this.evenRowClass),n.push(w(this.rowClass,this,t,e)),n.join(" ")},_attachRowHover:function(t){var e=this.selectedRowClass;t.hover(function(){i(this).addClass(e)},function(){i(this).removeClass(e)})},_renderCells:function(t,e){return this._eachField(function(n){t.append(this._createCell(e,n))}),this},_createCell:function(t,e){var n,a=this._getItemFieldValue(t,e),u={value:a,item:t};return n=i.isFunction(e.cellRenderer)?this.renderTemplate(e.cellRenderer,e,u):i("<td>").append(this.renderTemplate(e.itemTemplate||a,e,u)),this._prepareCell(n,e)},_getItemFieldValue:function(t,e){for(var n=e.name.split("."),a=t[n.shift()];a&&n.length;)a=a[n.shift()];return a},_setItemFieldValue:function(t,e,n){for(var a=e.name.split("."),u=t,g=a[0];u&&a.length;)t=u,g=a.shift(),u=t[g];if(!u)for(;a.length;)t=t[g]={},g=a.shift();t[g]=n},sort:function(t,e){return i.isPlainObject(t)&&(e=t.order,t=t.field),this._clearSortingCss(),this._setSortingParams(t,e),this._setSortingCss(),this._loadStrategy.sort()},_clearSortingCss:function(){this._headerRow.find("th").removeClass(this.sortAscClass).removeClass(this.sortDescClass)},_setSortingParams:function(t,e){t=this._normalizeField(t),e=e||(this._sortField===t?this._reversedSortOrder(this._sortOrder):p),this._sortField=t,this._sortOrder=e},_normalizeField:function(t){return i.isNumeric(t)?this.fields[t]:typeof t=="string"?i.grep(this.fields,function(e){return e.name===t})[0]:t},_reversedSortOrder:function(t){return t===p?f:p},_setSortingCss:function(){var t=this._visibleFieldIndex(this._sortField);this._headerRow.find("th").eq(t).addClass(this._sortOrder===p?this.sortAscClass:this.sortDescClass)},_visibleFieldIndex:function(t){return i.inArray(t,i.grep(this.fields,function(e){return e.visible}))},_sortData:function(){var t=this._sortFactor(),e=this._sortField;e&&this.data.sort(function(n,a){return t*e.sortingFunc(n[e.name],a[e.name])})},_sortFactor:function(){return this._sortOrder===p?1:-1},_itemsCount:function(){return this._loadStrategy.itemsCount()},_pagesCount:function(){var t=this._itemsCount(),e=this.pageSize;return Math.floor(t/e)+(t%e?1:0)},_refreshPager:function(){var t=this._pagerContainer;t.empty(),this.paging&&t.append(this._createPager());var e=this.paging&&this._pagesCount()>1;t.toggle(e)},_createPager:function(){var t;return t=i.isFunction(this.pagerRenderer)?i(this.pagerRenderer({pageIndex:this.pageIndex,pageCount:this._pagesCount()})):i("<div>").append(this._createPagerByFormat()),t.addClass(this.pagerClass),t},_createPagerByFormat:function(){var t=this.pageIndex,e=this._pagesCount(),n=this._itemsCount(),a=this.pagerFormat.split(" ");return i.map(a,i.proxy(function(u){var g=u;return u===C?g=this._createPages():u===v?g=this._createPagerNavButton(this.pageFirstText,1,t>1):u===m?g=this._createPagerNavButton(this.pagePrevText,t-1,t>1):u===y?g=this._createPagerNavButton(this.pageNextText,t+1,e>t):u===x?g=this._createPagerNavButton(this.pageLastText,e,e>t):u===R?g=t:u===D?g=e:u===E&&(g=n),i.isArray(g)?g.concat([" "]):[g," "]},this))},_createPages:function(){var t=this._pagesCount(),e=this.pageButtonCount,n=this._firstDisplayingPage,a=[];n>1&&a.push(this._createPagerPageNavButton(this.pageNavigatorPrevText,this.showPrevPages));for(var u=0,g=n;e>u&&t>=g;u++,g++)a.push(g===this.pageIndex?this._createPagerCurrentPage():this._createPagerPage(g));return t>n+e-1&&a.push(this._createPagerPageNavButton(this.pageNavigatorNextText,this.showNextPages)),a},_createPagerNavButton:function(t,e,n){return this._createPagerButton(t,this.pagerNavButtonClass+(n?"":" "+this.pagerNavButtonInactiveClass),n?function(){this.openPage(e)}:i.noop)},_createPagerPageNavButton:function(t,e){return this._createPagerButton(t,this.pagerNavButtonClass,e)},_createPagerPage:function(t){return this._createPagerButton(t,this.pageClass,function(){this.openPage(t)})},_createPagerButton:function(t,e,n){var a=i("<a>").attr("href",k).html(t).on("click",i.proxy(n,this));return i("<span>").addClass(e).append(a)},_createPagerCurrentPage:function(){return i("<span>").addClass(this.pageClass).addClass(this.currentPageClass).text(this.pageIndex)},_refreshSize:function(){this._refreshHeight(),this._refreshWidth()},_refreshWidth:function(){var t=this.width==="auto"?this._getAutoWidth():this.width;this._container.width(t)},_getAutoWidth:function(){var t=this._headerGrid,e=this._header;t.width("auto");var n=t.outerWidth(),a=e.outerWidth()-e.innerWidth();return t.width(""),n+a},_scrollBarWidth:function(){var t;return function(){if(t===c){var e=i("<div style='width:50px;height:50px;overflow:hidden;position:absolute;top:-10000px;left:-10000px;'></div>"),n=i("<div style='height:100px;'></div>");e.append(n).appendTo("body");var a=n.innerWidth();e.css("overflow-y","auto");var u=n.innerWidth();e.remove(),t=a-u}return t}}(),_refreshHeight:function(){var t,e=this._container,n=this._pagerContainer,a=this.height;e.height(a),a!=="auto"&&(a=e.height(),t=this._header.outerHeight(!0),n.parents(e).length&&(t+=n.outerHeight(!0)),this._body.outerHeight(a-t))},showPrevPages:function(){var t=this._firstDisplayingPage,e=this.pageButtonCount;this._firstDisplayingPage=t>e?t-e:1,this._refreshPager()},showNextPages:function(){var t=this._firstDisplayingPage,e=this.pageButtonCount,n=this._pagesCount();this._firstDisplayingPage=t+2*e>n?n-e+1:t+e,this._refreshPager()},openPage:function(t){1>t||t>this._pagesCount()||(this._setPage(t),this._loadStrategy.openPage(t))},_setPage:function(t){var e=this._firstDisplayingPage,n=this.pageButtonCount;this.pageIndex=t,e>t&&(this._firstDisplayingPage=t),t>e+n-1&&(this._firstDisplayingPage=t-n+1),this._callEventHandler(this.onPageChanged,{pageIndex:t})},_controllerCall:function(t,e,n,a){if(n)return i.Deferred().reject().promise();this._showLoading();var u=this._controller;if(!u||!u[t])throw Error("controller has no method '"+t+"'");return N(u[t](e)).done(i.proxy(a,this)).fail(i.proxy(this._errorHandler,this)).always(i.proxy(this._hideLoading,this))},_errorHandler:function(){this._callEventHandler(this.onError,{args:i.makeArray(arguments)})},_showLoading:function(){this.loadIndication&&(clearTimeout(this._loadingTimer),this._loadingTimer=setTimeout(i.proxy(function(){this._loadIndicator.show()},this),this.loadIndicationDelay))},_hideLoading:function(){this.loadIndication&&(clearTimeout(this._loadingTimer),this._loadIndicator.hide())},search:function(t){return this._resetSorting(),this._resetPager(),this.loadData(t)},loadData:function(t){t=t||(this.filtering?this.getFilter():{}),i.extend(t,this._loadStrategy.loadParams(),this._sortingParams());var e=this._callEventHandler(this.onDataLoading,{filter:t});return this._controllerCall("loadData",t,e.cancel,function(n){n&&(this._loadStrategy.finishLoad(n),this._callEventHandler(this.onDataLoaded,{data:n}))})},getFilter:function(){var t={};return this._eachField(function(e){e.filtering&&this._setItemFieldValue(t,e,e.filterValue())}),t},_sortingParams:function(){return this.sorting&&this._sortField?{sortField:this._sortField.name,sortOrder:this._sortOrder}:{}},getSorting:function(){var t=this._sortingParams();return{field:t.sortField,order:t.sortOrder}},clearFilter:function(){var t=this._createFilterRow();return this._filterRow.replaceWith(t),this._filterRow=t,this.search()},insertItem:function(t){var e=t||this._getValidatedInsertItem();if(!e)return i.Deferred().reject().promise();var n=this._callEventHandler(this.onItemInserting,{item:e});return this._controllerCall("insertItem",e,n.cancel,function(a){a=a||e,this._loadStrategy.finishInsert(a),this._callEventHandler(this.onItemInserted,{item:a})})},_getValidatedInsertItem:function(){var t=this._getInsertItem();return this._validateItem(t,this._insertRow)?t:null},_getInsertItem:function(){var t={};return this._eachField(function(e){e.inserting&&this._setItemFieldValue(t,e,e.insertValue())}),t},_validateItem:function(t,e){var n=[],a={item:t,itemIndex:this._rowIndex(e),row:e};if(this._eachField(function(g){if(g.validate&&(e!==this._insertRow||g.inserting)&&(e!==this._getEditRow()||g.editing)){var _=this._getItemFieldValue(t,g),I=this._validation.validate(i.extend({value:_,rules:g.validate},a));this._setCellValidity(e.children().eq(this._visibleFieldIndex(g)),I),I.length&&n.push.apply(n,i.map(I,function(B){return{field:g,message:B}}))}}),!n.length)return!0;var u=i.extend({errors:n},a);return this._callEventHandler(this.onItemInvalid,u),this.invalidNotify(u),!1},_setCellValidity:function(t,e){t.toggleClass(this.invalidClass,!!e.length).attr("title",e.join(`
`))},clearInsert:function(){var t=this._createInsertRow();this._insertRow.replaceWith(t),this._insertRow=t,this.refresh()},editItem:function(t){var e=this.rowByItem(t);e.length&&this._editRow(e)},rowByItem:function(t){return t.jquery||t.nodeType?i(t):this._content.find("tr").filter(function(){return i.data(this,h)===t})},_editRow:function(t){if(this.editing){var e=t.data(h),n=this._callEventHandler(this.onItemEditing,{row:t,item:e,itemIndex:this._itemIndex(e)});if(!n.cancel){this._editingRow&&this.cancelEdit();var a=this._createEditRow(e);this._editingRow=t,t.hide(),a.insertBefore(t),t.data(o,a)}}},_createEditRow:function(t){if(i.isFunction(this.editRowRenderer))return i(this.renderTemplate(this.editRowRenderer,this,{item:t,itemIndex:this._itemIndex(t)}));var e=i("<tr>").addClass(this.editRowClass);return this._eachField(function(n){var a=this._getItemFieldValue(t,n);this._prepareCell("<td>",n,"editcss").append(this.renderTemplate(n.editTemplate||"",n,{value:a,item:t})).appendTo(e)}),e},updateItem:function(t,e){arguments.length===1&&(e=t);var n=t?this.rowByItem(t):this._editingRow;return(e=e||this._getValidatedEditedItem())?this._updateRow(n,e):void 0},_getValidatedEditedItem:function(){var t=this._getEditedItem();return this._validateItem(t,this._getEditRow())?t:null},_updateRow:function(t,e){var n=t.data(h),a=this._itemIndex(n),u=i.extend(!0,{},n,e),g=this._callEventHandler(this.onItemUpdating,{row:t,item:u,itemIndex:a,previousItem:n});return this._controllerCall("updateItem",u,g.cancel,function(_){var I=i.extend(!0,{},n);u=_||i.extend(!0,n,e);var B=this._finishUpdate(t,u,a);this._callEventHandler(this.onItemUpdated,{row:B,item:u,itemIndex:a,previousItem:I})})},_rowIndex:function(t){return this._content.children().index(i(t))},_itemIndex:function(t){return i.inArray(t,this.data)},_finishUpdate:function(t,e,n){this.cancelEdit(),this.data[n]=e;var a=this._createRow(e,n);return t.replaceWith(a),a},_getEditedItem:function(){var t={};return this._eachField(function(e){e.editing&&this._setItemFieldValue(t,e,e.editValue())}),t},cancelEdit:function(){this._editingRow&&(this._getEditRow().remove(),this._editingRow.show(),this._editingRow=null)},_getEditRow:function(){return this._editingRow&&this._editingRow.data(o)},deleteItem:function(t){var e=this.rowByItem(t);if(e.length&&(!this.confirmDeleting||d.confirm(w(this.deleteConfirm,this,e.data(h)))))return this._deleteRow(e)},_deleteRow:function(t){var e=t.data(h),n=this._itemIndex(e),a=this._callEventHandler(this.onItemDeleting,{row:t,item:e,itemIndex:n});return this._controllerCall("deleteItem",e,a.cancel,function(){this._loadStrategy.finishDelete(e,n),this._callEventHandler(this.onItemDeleted,{row:t,item:e,itemIndex:n})})}},i.fn.jsGrid=function(t){var e=i.makeArray(arguments),n=e.slice(1),a=this;return this.each(function(){var u,g=i(this),_=g.data(s);if(_)if(typeof t=="string"){if(u=_[t].apply(_,n),u!==c&&u!==_)return a=u,!1}else _._detachWindowResizeCallback(),_._init(t),_.render();else new l(g,t)}),a};var F={},G=function(t){var e;i.isPlainObject(t)?e=l.prototype:(e=F[t].prototype,t=arguments[1]||{}),i.extend(e,t)},j={},O=function(t){var e=i.isPlainObject(t)?t:j[t];if(!e)throw Error("unknown locale "+t);P(jsGrid,e)},P=function(t,e){i.each(e,function(n,a){return i.isPlainObject(a)?void P(t[n]||t[n[0].toUpperCase()+n.slice(1)],a):void(t.hasOwnProperty(n)?t[n]=a:t.prototype[n]=a)})};d.jsGrid={Grid:l,fields:F,setDefaults:G,locales:j,locale:O,version:"1.5.3"}})(window,jQuery),function(d,i){function c(l){this._init(l)}c.prototype={container:"body",message:"Loading...",shading:!0,zIndex:1e3,shaderClass:"jsgrid-load-shader",loadPanelClass:"jsgrid-load-panel",_init:function(l){i.extend(!0,this,l),this._initContainer(),this._initShader(),this._initLoadPanel()},_initContainer:function(){this._container=i(this.container)},_initShader:function(){this.shading&&(this._shader=i("<div>").addClass(this.shaderClass).hide().css({position:"absolute",top:0,right:0,bottom:0,left:0,zIndex:this.zIndex}).appendTo(this._container))},_initLoadPanel:function(){this._loadPanel=i("<div>").addClass(this.loadPanelClass).text(this.message).hide().css({position:"absolute",top:"50%",left:"50%",zIndex:this.zIndex}).appendTo(this._container)},show:function(){var l=this._loadPanel.show(),r=l.outerWidth(),s=l.outerHeight();l.css({marginTop:-s/2,marginLeft:-r/2}),this._shader.show()},hide:function(){this._loadPanel.hide(),this._shader.hide()}},d.LoadIndicator=c}(jsGrid,jQuery),function(d,i){function c(r){this._grid=r}function l(r){this._grid=r,this._itemsCount=0}c.prototype={firstDisplayIndex:function(){var r=this._grid;return r.option("paging")?(r.option("pageIndex")-1)*r.option("pageSize"):0},lastDisplayIndex:function(){var r=this._grid,s=r.option("data").length;return r.option("paging")?Math.min(r.option("pageIndex")*r.option("pageSize"),s):s},itemsCount:function(){return this._grid.option("data").length},openPage:function(){this._grid.refresh()},loadParams:function(){return{}},sort:function(){return this._grid._sortData(),this._grid.refresh(),i.Deferred().resolve().promise()},reset:function(){return this._grid.refresh(),i.Deferred().resolve().promise()},finishLoad:function(r){this._grid.option("data",r)},finishInsert:function(r){var s=this._grid;s.option("data").push(r),s.refresh()},finishDelete:function(r,s){var h=this._grid;h.option("data").splice(s,1),h.reset()}},l.prototype={firstDisplayIndex:function(){return 0},lastDisplayIndex:function(){return this._grid.option("data").length},itemsCount:function(){return this._itemsCount},openPage:function(){this._grid.loadData()},loadParams:function(){var r=this._grid;return{pageIndex:r.option("pageIndex"),pageSize:r.option("pageSize")}},reset:function(){return this._grid.loadData()},sort:function(){return this._grid.loadData()},finishLoad:function(r){this._itemsCount=r.itemsCount,this._grid.option("data",r.data)},finishInsert:function(){this._grid.search()},finishDelete:function(){this._grid.search()}},d.loadStrategies={DirectLoadingStrategy:c,PageLoadingStrategy:l}}(jsGrid,jQuery),function(d){var i=function(l){return typeof l<"u"&&l!==null},c={string:function(l,r){return i(l)||i(r)?i(l)?i(r)?(""+l).localeCompare(""+r):1:-1:0},number:function(l,r){return l-r},date:function(l,r){return l-r},numberAsString:function(l,r){return parseFloat(l)-parseFloat(r)}};d.sortStrategies=c}(jsGrid,jQuery),function(d,i,c){function l(s){this._init(s)}l.prototype={_init:function(s){i.extend(!0,this,s)},validate:function(s){var h=[];return i.each(this._normalizeRules(s.rules),function(o,p){if(!p.validator(s.value,s.item,p.param)){var f=i.isFunction(p.message)?p.message(s.value,s.item):p.message;h.push(f)}}),h},_normalizeRules:function(s){return i.isArray(s)||(s=[s]),i.map(s,i.proxy(function(h){return this._normalizeRule(h)},this))},_normalizeRule:function(s){if(typeof s=="string"&&(s={validator:s}),i.isFunction(s)&&(s={validator:s}),!i.isPlainObject(s))throw Error("wrong validation config specified");return s=i.extend({},s),i.isFunction(s.validator)?s:this._applyNamedValidator(s,s.validator)},_applyNamedValidator:function(s,h){delete s.validator;var o=r[h];if(!o)throw Error('unknown validator "'+h+'"');return i.isFunction(o)&&(o={validator:o}),i.extend({},o,s)}},d.Validation=l;var r={required:{message:"Field is required",validator:function(s){return s!==c&&s!==null&&s!==""}},rangeLength:{message:"Field value length is out of the defined range",validator:function(s,h,o){return s.length>=o[0]&&s.length<=o[1]}},minLength:{message:"Field value is too short",validator:function(s,h,o){return s.length>=o}},maxLength:{message:"Field value is too long",validator:function(s,h,o){return s.length<=o}},pattern:{message:"Field value is not matching the defined pattern",validator:function(s,h,o){return typeof o=="string"&&(o=new RegExp("^(?:"+o+")$")),o.test(s)}},range:{message:"Field value is out of the defined range",validator:function(s,h,o){return s>=o[0]&&s<=o[1]}},min:{message:"Field value is too small",validator:function(s,h,o){return s>=o}},max:{message:"Field value is too large",validator:function(s,h,o){return o>=s}}};d.validators=r}(jsGrid,jQuery),function(d,i,c){function l(r){i.extend(!0,this,r),this.sortingFunc=this._getSortingFunc()}l.prototype={name:"",title:null,css:"",align:"",width:100,visible:!0,filtering:!0,inserting:!0,editing:!0,sorting:!0,sorter:"string",headerTemplate:function(){return this.title===c||this.title===null?this.name:this.title},itemTemplate:function(r){return r},filterTemplate:function(){return""},insertTemplate:function(){return""},editTemplate:function(r,s){return this._value=r,this.itemTemplate(r,s)},filterValue:function(){return""},insertValue:function(){return""},editValue:function(){return this._value},_getSortingFunc:function(){var r=this.sorter;if(i.isFunction(r))return r;if(typeof r=="string")return d.sortStrategies[r];throw Error('wrong sorter for the field "'+this.name+'"!')}},d.Field=l}(jsGrid,jQuery),function(d,i){function c(r){l.call(this,r)}var l=d.Field;c.prototype=new l({autosearch:!0,readOnly:!1,filterTemplate:function(){if(!this.filtering)return"";var r=this._grid,s=this.filterControl=this._createTextBox();return this.autosearch&&s.on("keypress",function(h){h.which===13&&(r.search(),h.preventDefault())}),s},insertTemplate:function(){return this.inserting?this.insertControl=this._createTextBox():""},editTemplate:function(r){if(!this.editing)return this.itemTemplate.apply(this,arguments);var s=this.editControl=this._createTextBox();return s.val(r),s},filterValue:function(){return this.filterControl.val()},insertValue:function(){return this.insertControl.val()},editValue:function(){return this.editControl.val()},_createTextBox:function(){return i("<input>").attr("type","text").prop("readonly",!!this.readOnly)}}),d.fields.text=d.TextField=c}(jsGrid,jQuery),function(d,i,c){function l(s){r.call(this,s)}var r=d.TextField;l.prototype=new r({sorter:"number",align:"right",readOnly:!1,filterValue:function(){return this.filterControl.val()?parseInt(this.filterControl.val()||0,10):c},insertValue:function(){return this.insertControl.val()?parseInt(this.insertControl.val()||0,10):c},editValue:function(){return this.editControl.val()?parseInt(this.editControl.val()||0,10):c},_createTextBox:function(){return i("<input>").attr("type","number").prop("readonly",!!this.readOnly)}}),d.fields.number=d.NumberField=l}(jsGrid,jQuery),function(d,i){function c(r){l.call(this,r)}var l=d.TextField;c.prototype=new l({insertTemplate:function(){return this.inserting?this.insertControl=this._createTextArea():""},editTemplate:function(r){if(!this.editing)return this.itemTemplate.apply(this,arguments);var s=this.editControl=this._createTextArea();return s.val(r),s},_createTextArea:function(){return i("<textarea>").prop("readonly",!!this.readOnly)}}),d.fields.textarea=d.TextAreaField=c}(jsGrid,jQuery),function(d,i,c){function l(o){if(this.items=[],this.selectedIndex=-1,this.valueField="",this.textField="",o.valueField&&o.items.length){var p=o.items[0][o.valueField];this.valueType=typeof p===s?s:h}this.sorter=this.valueType,r.call(this,o)}var r=d.NumberField,s="number",h="string";l.prototype=new r({align:"center",valueType:s,itemTemplate:function(o){var p,f=this.items,v=this.valueField,C=this.textField;p=v?i.grep(f,function(y){return y[v]===o})[0]||{}:f[o];var m=C?p[C]:p;return m===c||m===null?"":m},filterTemplate:function(){if(!this.filtering)return"";var o=this._grid,p=this.filterControl=this._createSelect();return this.autosearch&&p.on("change",function(){o.search()}),p},insertTemplate:function(){return this.inserting?this.insertControl=this._createSelect():""},editTemplate:function(o){if(!this.editing)return this.itemTemplate.apply(this,arguments);var p=this.editControl=this._createSelect();return o!==c&&p.val(o),p},filterValue:function(){var o=this.filterControl.val();return this.valueType===s?parseInt(o||0,10):o},insertValue:function(){var o=this.insertControl.val();return this.valueType===s?parseInt(o||0,10):o},editValue:function(){var o=this.editControl.val();return this.valueType===s?parseInt(o||0,10):o},_createSelect:function(){var o=i("<select>"),p=this.valueField,f=this.textField,v=this.selectedIndex;return i.each(this.items,function(C,m){var y=p?m[p]:C,x=f?m[f]:m,R=i("<option>").attr("value",y).text(x).appendTo(o);R.prop("selected",v===C)}),o.prop("disabled",!!this.readOnly),o}}),d.fields.select=d.SelectField=l}(jsGrid,jQuery),function(d,i,c){function l(s){r.call(this,s)}var r=d.Field;l.prototype=new r({sorter:"number",align:"center",autosearch:!0,itemTemplate:function(s){return this._createCheckbox().prop({checked:s,disabled:!0})},filterTemplate:function(){if(!this.filtering)return"";var s=this._grid,h=this.filterControl=this._createCheckbox();return h.prop({readOnly:!0,indeterminate:!0}),h.on("click",function(){var o=i(this);o.prop("readOnly")?o.prop({checked:!1,readOnly:!1}):o.prop("checked")||o.prop({readOnly:!0,indeterminate:!0})}),this.autosearch&&h.on("click",function(){s.search()}),h},insertTemplate:function(){return this.inserting?this.insertControl=this._createCheckbox():""},editTemplate:function(s){if(!this.editing)return this.itemTemplate.apply(this,arguments);var h=this.editControl=this._createCheckbox();return h.prop("checked",s),h},filterValue:function(){return this.filterControl.get(0).indeterminate?c:this.filterControl.is(":checked")},insertValue:function(){return this.insertControl.is(":checked")},editValue:function(){return this.editControl.is(":checked")},_createCheckbox:function(){return i("<input>").attr("type","checkbox")}}),d.fields.checkbox=d.CheckboxField=l}(jsGrid,jQuery),function(d,i){function c(r){l.call(this,r),this._configInitialized=!1}var l=d.Field;c.prototype=new l({css:"jsgrid-control-field",align:"center",width:50,filtering:!1,inserting:!1,editing:!1,sorting:!1,buttonClass:"jsgrid-button",modeButtonClass:"jsgrid-mode-button",modeOnButtonClass:"jsgrid-mode-on-button",searchModeButtonClass:"jsgrid-search-mode-button",insertModeButtonClass:"jsgrid-insert-mode-button",editButtonClass:"jsgrid-edit-button",deleteButtonClass:"jsgrid-delete-button",searchButtonClass:"jsgrid-search-button",clearFilterButtonClass:"jsgrid-clear-filter-button",insertButtonClass:"jsgrid-insert-button",updateButtonClass:"jsgrid-update-button",cancelEditButtonClass:"jsgrid-cancel-edit-button",searchModeButtonTooltip:"Switch to searching",insertModeButtonTooltip:"Switch to inserting",editButtonTooltip:"Edit",deleteButtonTooltip:"Delete",searchButtonTooltip:"Search",clearFilterButtonTooltip:"Clear filter",insertButtonTooltip:"Insert",updateButtonTooltip:"Update",cancelEditButtonTooltip:"Cancel edit",editButton:!0,deleteButton:!0,clearFilterButton:!0,modeSwitchButton:!0,_initConfig:function(){this._hasFiltering=this._grid.filtering,this._hasInserting=this._grid.inserting,this._hasInserting&&this.modeSwitchButton&&(this._grid.inserting=!1),this._configInitialized=!0},headerTemplate:function(){this._configInitialized||this._initConfig();var r=this._hasFiltering,s=this._hasInserting;return this.modeSwitchButton&&(r||s)?r&&!s?this._createFilterSwitchButton():s&&!r?this._createInsertSwitchButton():this._createModeSwitchButton():""},itemTemplate:function(r,s){var h=i([]);return this.editButton&&(h=h.add(this._createEditButton(s))),this.deleteButton&&(h=h.add(this._createDeleteButton(s))),h},filterTemplate:function(){var r=this._createSearchButton();return this.clearFilterButton?r.add(this._createClearFilterButton()):r},insertTemplate:function(){return this._createInsertButton()},editTemplate:function(){return this._createUpdateButton().add(this._createCancelEditButton())},_createFilterSwitchButton:function(){return this._createOnOffSwitchButton("filtering",this.searchModeButtonClass,!0)},_createInsertSwitchButton:function(){return this._createOnOffSwitchButton("inserting",this.insertModeButtonClass,!1)},_createOnOffSwitchButton:function(r,s,h){var o=h,p=i.proxy(function(){f.toggleClass(this.modeOnButtonClass,o)},this),f=this._createGridButton(this.modeButtonClass+" "+s,"",function(v){o=!o,v.option(r,o),p()});return p(),f},_createModeSwitchButton:function(){var r=!1,s=i.proxy(function(){h.attr("title",r?this.searchModeButtonTooltip:this.insertModeButtonTooltip).toggleClass(this.insertModeButtonClass,!r).toggleClass(this.searchModeButtonClass,r)},this),h=this._createGridButton(this.modeButtonClass,"",function(o){r=!r,o.option("inserting",r),o.option("filtering",!r),s()});return s(),h},_createEditButton:function(r){return this._createGridButton(this.editButtonClass,this.editButtonTooltip,function(s,h){s.editItem(r),h.stopPropagation()})},_createDeleteButton:function(r){return this._createGridButton(this.deleteButtonClass,this.deleteButtonTooltip,function(s,h){s.deleteItem(r),h.stopPropagation()})},_createSearchButton:function(){return this._createGridButton(this.searchButtonClass,this.searchButtonTooltip,function(r){r.search()})},_createClearFilterButton:function(){return this._createGridButton(this.clearFilterButtonClass,this.clearFilterButtonTooltip,function(r){r.clearFilter()})},_createInsertButton:function(){return this._createGridButton(this.insertButtonClass,this.insertButtonTooltip,function(r){r.insertItem().done(function(){r.clearInsert()})})},_createUpdateButton:function(){return this._createGridButton(this.updateButtonClass,this.updateButtonTooltip,function(r,s){r.updateItem(),s.stopPropagation()})},_createCancelEditButton:function(){return this._createGridButton(this.cancelEditButtonClass,this.cancelEditButtonTooltip,function(r,s){r.cancelEdit(),s.stopPropagation()})},_createGridButton:function(r,s,h){var o=this._grid;return i("<input>").addClass(this.buttonClass).addClass(r).attr({type:"button",title:s}).on("click",function(p){h(o,p)})},editValue:function(){return""}}),d.fields.control=d.ControlField=c}(jsGrid,jQuery);var S={loadData:function(d){var i=$.Deferred();return $.ajax({type:"GET",url:"/assets/data/jsgrid.json",data:d,success:function(c){var l=$.grep(c,function(r){return(!d.Name||r.Name.indexOf(d.Name)>-1)&&(!d.Age||r.Age===d.Age)&&(!d.Address||r.Address.indexOf(d.Address)>-1)&&(!d.Country||r.Country===d.Country)});i.resolve(l)}}),i.promise()},insertItem:function(d){return $.ajax({type:"POST",url:"assets/data/jsgrid.json",data:d})},updateItem:function(d){return $.ajax({type:"PUT",url:"assets/data/jsgrid.json",data:d})},deleteItem:function(d){return $.ajax({type:"DELETE",url:"assets/data/jsgrid.json",data:d})},countries:[{Name:"",Id:0},{Name:"United States",Id:1},{Name:"Canada",Id:2},{Name:"United Kingdom",Id:3},{Name:"France",Id:4},{Name:"Brazil",Id:5},{Name:"China",Id:6},{Name:"Russia",Id:7}]};(function(d){var i=function(){this.$body=d("body")};i.prototype.createGrid=function(c,l){var r={height:"550",width:"100%",filtering:!0,editing:!0,inserting:!0,sorting:!0,paging:!0,autoload:!0,pageSize:10,pageButtonCount:5,deleteConfirm:"Do you really want to delete the entry?"};c.jsGrid(d.extend(r,l))},i.prototype.init=function(){var c=this,l={fields:[{name:"Name",type:"text",width:150},{name:"Age",type:"number",width:50},{name:"Address",type:"text",width:200},{name:"Country",type:"select",items:S.countries,valueField:"Id",textField:"Name"},{type:"control"}],controller:S};c.createGrid(d("#jsGrid"),l)},d.GridApp=new i,d.GridApp.Constructor=i})(window.jQuery),function(d){document.addEventListener("DOMContentLoaded",function(){d.GridApp.init()},!1)}(window.jQuery);
