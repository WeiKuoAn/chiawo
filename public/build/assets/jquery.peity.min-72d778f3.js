(function(m,R,s,L){var f=m.fn.peity=function(t,i){return Q&&this.each(function(){var e=m(this),r=e.data("_peity");r?(t&&(r.type=t),m.extend(r.opts,i)):(r=new W(e,t,m.extend({},f.defaults[t],e.data("peity"),i)),e.change(function(){r.draw()}).data("_peity",r)),r.draw()}),this},W=function(t,i,e){this.$el=t,this.type=i,this.opts=e},F=W.prototype,x=F.svgElement=function(t,i){return m(R.createElementNS("http://www.w3.org/2000/svg",t)).attr(i)},Q="createElementNS"in R&&x("svg",{})[0].createSVGRect;F.draw=function(){var t=this.opts;f.graphers[this.type].call(this,t),t.after&&t.after.call(this,t)},F.fill=function(){var t=this.opts.fill;return m.isFunction(t)?t:function(i,e){return t[e%t.length]}},F.prepare=function(t,i){return this.$svg||this.$el.hide().after(this.$svg=x("svg",{class:"peity"})),this.$svg.empty().data("_peity",this).attr({height:i,width:t})},F.values=function(){return m.map(this.$el.text().split(this.opts.delimiter),function(t){return parseFloat(t)})},f.defaults={},f.graphers={},f.register=function(t,i,e){this.defaults[t]=i,this.graphers[t]=e},f.register("pie",{fill:["#ff9900","#fff4dd","#ffc66e"],radius:8},function(t){if(!t.delimiter){var i=this.$el.text().match(/[^0-9\.]/);t.delimiter=i?i[0]:","}var e=m.map(this.values(),function(N){return N>0?N:0});if(t.delimiter=="/"){var r=e[0],u=e[1];e=[r,s.max(0,u-r)]}for(var h=0,g=e.length,l=0;h<g;h++)l+=e[h];l||(g=2,l=1,e=[0,1]);var w=2*t.radius,_=this.prepare(t.width||w,t.height||w),p=_.width()/2,c=_.height()/2,n=s.min(p,c),a=t.innerRadius;this.type!="donut"||a||(a=.5*n);var v=s.PI,E=this.fill(),y=this.scale=function(N,I){var P=N/l*v*2-v/2;return[I*s.cos(P)+p,I*s.sin(P)+c]},j=0;for(h=0;h<g;h++){var d,o=e[h],A=o/l;if(A!=0){if(A==1)if(a){var b=p-.01,q=c-n,D=c-a;d=x("path",{d:["M",p,q,"A",n,n,0,1,1,b,q,"L",b,D,"A",a,a,0,1,0,p,D].join(" "),"data-value":o})}else d=x("circle",{cx:p,cy:c,"data-value":o,r:n});else{var G=j+o,M=["M"].concat(y(j,n),"A",n,n,0,A>.5?1:0,1,y(G,n),"L");a?M=M.concat(y(G,a),"A",a,a,0,A>.5?1:0,0,y(j,a)):M.push(p,c),j+=o,d=x("path",{d:M.join(" "),"data-value":o})}d.attr("fill",E.call(this,o,h,e)),_.append(d)}}}),f.register("donut",m.extend(!0,{},f.defaults.pie),function(t){f.graphers.pie.call(this,t)}),f.register("line",{delimiter:",",fill:"#c6d9fd",height:16,min:0,stroke:"#4d89f9",strokeWidth:1,width:32},function(t){var i=this.values();i.length==1&&i.push(i[0]);for(var e=s.max.apply(s,t.max==L?i:i.concat(t.max)),r=s.min.apply(s,t.min==L?i:i.concat(t.min)),u=this.prepare(t.width,t.height),h=t.strokeWidth,g=u.width(),l=u.height()-h,w=e-r,_=this.x=function(v){return v*(g/(i.length-1))},p=this.y=function(v){var E=l;return w&&(E-=(v-r)/w*l),E+h/2},c=p(s.max(r,0)),n=[0,c],a=0;a<i.length;a++)n.push(_(a),p(i[a]));n.push(g,c),t.fill&&u.append(x("polygon",{fill:t.fill,points:n.join(" ")})),h&&u.append(x("polyline",{fill:"none",points:n.slice(2,n.length-2).join(" "),stroke:t.stroke,"stroke-width":h,"stroke-linecap":"square"}))}),f.register("bar",{delimiter:",",fill:["#4D89F9"],height:16,min:0,padding:.1,width:32},function(t){for(var i=this.values(),e=s.max.apply(s,t.max==L?i:i.concat(t.max)),r=s.min.apply(s,t.min==L?i:i.concat(t.min)),u=this.prepare(t.width,t.height),h=u.width(),g=u.height(),l=e-r,w=t.padding,_=this.fill(),p=this.x=function(A){return A*h/i.length},c=this.y=function(A){return g-(l?(A-r)/l*g:1)},n=0;n<i.length;n++){var a,v=p(n+w),E=p(n+1-w)-v,y=i[n],j=c(y),d=j,o=j;l?y<0?d=c(s.min(e,0)):o=c(s.max(r,0)):a=1,(a=o-d)==0&&(a=1,e>0&&l&&d--),u.append(x("rect",{"data-value":y,fill:_.call(this,y,n,i),x:v,y:d,width:E,height:a}))}})})(jQuery,document,Math);
