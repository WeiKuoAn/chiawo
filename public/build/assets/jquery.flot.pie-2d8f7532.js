(function(S){var W=10,G=.95;function U(d){var N=null,k=null,r=null,u=null,g=null,I=null,C=!1,s=null,w=[];d.hooks.processOptions.push(function(e,i){i.series.pie.show&&(i.grid.show=!1,i.series.pie.label.show=="auto"&&(i.legend.show?i.series.pie.label.show=!1:i.series.pie.label.show=!0),i.series.pie.radius=="auto"&&(i.series.pie.label.show?i.series.pie.radius=3/4:i.series.pie.radius=1),i.series.pie.tilt>1?i.series.pie.tilt=1:i.series.pie.tilt<0&&(i.series.pie.tilt=0))}),d.hooks.bindEvents.push(function(e,i){var a=e.getOptions();a.series.pie.show&&(a.grid.hoverable&&i.unbind("mousemove").mousemove(re),a.grid.clickable&&i.unbind("click").click(se))}),d.hooks.processDatapoints.push(function(e,i,a,h){var f=e.getOptions();f.series.pie.show&&Z(e)}),d.hooks.drawOverlay.push(function(e,i){var a=e.getOptions();a.series.pie.show&&ne(e,i)}),d.hooks.draw.push(function(e,i){var a=e.getOptions();a.series.pie.show&&$(e,i)});function Z(e,i,a){C||(C=!0,N=e.getCanvas(),k=S(N).parent(),r=e.getOptions(),e.setData(j(e.getData())))}function j(e){for(var i=0,a=0,h=0,f=r.series.pie.combine.color,o=[],t=0;t<e.length;++t){var n=e[t].data;S.isArray(n)&&n.length==1&&(n=n[0]),S.isArray(n)?!isNaN(parseFloat(n[1]))&&isFinite(n[1])?n[1]=+n[1]:n[1]=0:!isNaN(parseFloat(n))&&isFinite(n)?n=[1,+n]:n=[1,0],e[t].data=[n]}for(var t=0;t<e.length;++t)i+=e[t].data[0][1];for(var t=0;t<e.length;++t){var n=e[t].data[0][1];n/i<=r.series.pie.combine.threshold&&(a+=n,h++,f||(f=e[t].color))}for(var t=0;t<e.length;++t){var n=e[t].data[0][1];(h<2||n/i>r.series.pie.combine.threshold)&&o.push(S.extend(e[t],{data:[[1,n]],color:e[t].color,label:e[t].label,angle:n*Math.PI*2/i,percent:n/(i/100)}))}return h>1&&o.push({data:[[1,a]],color:f,label:r.series.pie.combine.label,angle:a*Math.PI*2/i,percent:a/(i/100)}),o}function $(e,i){if(!k)return;var a=e.getPlaceholder().width(),h=e.getPlaceholder().height(),f=k.children().filter(".legend").children().width()||0;s=i,C=!1,u=Math.min(a,h/r.series.pie.tilt)/2,I=h/2+r.series.pie.offset.top,g=a/2,r.series.pie.offset.left=="auto"?(r.legend.position.match("w")?g+=f/2:g-=f/2,g<u?g=u:g>a-u&&(g=a-u)):g+=r.series.pie.offset.left;var o=e.getData(),t=0;do t>0&&(u*=G),t+=1,n(),r.series.pie.tilt<=.8&&l();while(!H()&&t<W);t>=W&&(n(),k.prepend("<div class='error'>Could not draw pie with labels contained inside canvas</div>")),e.setSeries&&e.insertLegend&&(e.setSeries(o),e.insertLegend());function n(){s.clearRect(0,0,a,h),k.children().filter(".pieLabel, .pieLabelBackground").remove()}function l(){var m=r.series.pie.shadow.left,O=r.series.pie.shadow.top,c=10,p=r.series.pie.shadow.alpha,A=r.series.pie.radius>1?r.series.pie.radius:u*r.series.pie.radius;if(!(A>=a/2-m||A*r.series.pie.tilt>=h/2-O||A<=c)){s.save(),s.translate(m,O),s.globalAlpha=p,s.fillStyle="#000",s.translate(g,I),s.scale(1,r.series.pie.tilt);for(var R=1;R<=c;R++)s.beginPath(),s.arc(0,0,A,0,Math.PI*2,!1),s.fill(),A-=R;s.restore()}}function H(){var m=Math.PI*r.series.pie.startAngle,O=r.series.pie.radius>1?r.series.pie.radius:u*r.series.pie.radius;s.save(),s.translate(g,I),s.scale(1,r.series.pie.tilt),s.save();for(var c=m,p=0;p<o.length;++p)o[p].startAngle=c,A(o[p].angle,o[p].color,!0);if(s.restore(),r.series.pie.stroke.width>0){s.save(),s.lineWidth=r.series.pie.stroke.width,c=m;for(var p=0;p<o.length;++p)A(o[p].angle,r.series.pie.stroke.color,!1);s.restore()}if(y(s),s.restore(),r.series.pie.label.show)return R();return!0;function A(v,L,b){v<=0||isNaN(v)||(b?s.fillStyle=L:(s.strokeStyle=L,s.lineJoin="round"),s.beginPath(),Math.abs(v-Math.PI*2)>1e-9&&s.moveTo(0,0),s.arc(0,0,O,c,c+v/2,!1),s.arc(0,0,O,c+v/2,c+v,!1),s.closePath(),c+=v,b?s.fill():s.stroke())}function R(){for(var v=m,L=r.series.pie.label.radius>1?r.series.pie.label.radius:u*r.series.pie.label.radius,b=0;b<o.length;++b){if(o[b].percent>=r.series.pie.label.threshold*100&&!E(o[b],v,b))return!1;v+=o[b].angle}return!0;function E(M,Y,_){if(M.data[0][1]==0)return!0;var z=r.legend.labelFormatter,D,J=r.series.pie.label.formatter;z?D=z(M.label,M):D=M.label,J&&(D=J(D,M));var K=(Y+M.angle+Y)/2,Q=g+Math.round(Math.cos(K)*L),q=I+Math.round(Math.sin(K)*L)*r.series.pie.tilt,le="<span class='pieLabel' id='pieLabel"+_+"' style='position:absolute;top:"+q+"px;left:"+Q+"px;'>"+D+"</span>";k.append(le);var P=k.children("#pieLabel"+_),T=q-P.height()/2,x=Q-P.width()/2;if(P.css("top",T),P.css("left",x),0-T>0||0-x>0||h-(T+P.height())<0||a-(x+P.width())<0)return!1;if(r.series.pie.label.background.opacity!=0){var F=r.series.pie.label.background.color;F==null&&(F=M.color);var oe="top:"+T+"px;left:"+x+"px;";S("<div class='pieLabelBackground' style='position:absolute;width:"+P.width()+"px;height:"+P.height()+"px;"+oe+"background-color:"+F+";'></div>").css("opacity",r.series.pie.label.background.opacity).insertBefore(P)}return!0}}}}function y(e){if(r.series.pie.innerRadius>0){e.save();var i=r.series.pie.innerRadius>1?r.series.pie.innerRadius:u*r.series.pie.innerRadius;e.globalCompositeOperation="destination-out",e.beginPath(),e.fillStyle=r.series.pie.stroke.color,e.arc(0,0,i,0,Math.PI*2,!1),e.fill(),e.closePath(),e.restore(),e.save(),e.beginPath(),e.strokeStyle=r.series.pie.stroke.color,e.arc(0,0,i,0,Math.PI*2,!1),e.stroke(),e.closePath(),e.restore()}}function ee(e,i){for(var a=!1,h=-1,f=e.length,o=f-1;++h<f;o=h)(e[h][1]<=i[1]&&i[1]<e[o][1]||e[o][1]<=i[1]&&i[1]<e[h][1])&&i[0]<(e[o][0]-e[h][0])*(i[1]-e[h][1])/(e[o][1]-e[h][1])+e[h][0]&&(a=!a);return a}function ie(e,i){for(var a=d.getData(),h=d.getOptions(),f=h.series.pie.radius>1?h.series.pie.radius:u*h.series.pie.radius,o,t,n=0;n<a.length;++n){var l=a[n];if(l.pie.show){if(s.save(),s.beginPath(),s.moveTo(0,0),s.arc(0,0,f,l.startAngle,l.startAngle+l.angle/2,!1),s.arc(0,0,f,l.startAngle+l.angle/2,l.startAngle+l.angle,!1),s.closePath(),o=e-g,t=i-I,s.isPointInPath){if(s.isPointInPath(e-g,i-I))return s.restore(),{datapoint:[l.percent,l.data],dataIndex:0,series:l,seriesIndex:n}}else{var H=f*Math.cos(l.startAngle),m=f*Math.sin(l.startAngle),O=f*Math.cos(l.startAngle+l.angle/4),c=f*Math.sin(l.startAngle+l.angle/4),p=f*Math.cos(l.startAngle+l.angle/2),A=f*Math.sin(l.startAngle+l.angle/2),R=f*Math.cos(l.startAngle+l.angle/1.5),v=f*Math.sin(l.startAngle+l.angle/1.5),L=f*Math.cos(l.startAngle+l.angle),b=f*Math.sin(l.startAngle+l.angle),E=[[0,0],[H,m],[O,c],[p,A],[R,v],[L,b]],M=[o,t];if(ee(E,M))return s.restore(),{datapoint:[l.percent,l.data],dataIndex:0,series:l,seriesIndex:n}}s.restore()}}return null}function re(e){B("plothover",e)}function se(e){B("plotclick",e)}function B(e,i){var a=d.offset(),h=parseInt(i.pageX-a.left),f=parseInt(i.pageY-a.top),o=ie(h,f);if(r.grid.autoHighlight)for(var t=0;t<w.length;++t){var n=w[t];n.auto==e&&!(o&&n.series==o.series)&&te(n.series)}o&&ae(o.series,e);var l={pageX:i.pageX,pageY:i.pageY};k.trigger(e,[l,o])}function ae(e,i){var a=X(e);a==-1?(w.push({series:e,auto:i}),d.triggerRedrawOverlay()):i||(w[a].auto=!1)}function te(e){e==null&&(w=[],d.triggerRedrawOverlay());var i=X(e);i!=-1&&(w.splice(i,1),d.triggerRedrawOverlay())}function X(e){for(var i=0;i<w.length;++i){var a=w[i];if(a.series==e)return i}return-1}function ne(e,i){var a=e.getOptions(),h=a.series.pie.radius>1?a.series.pie.radius:u*a.series.pie.radius;i.save(),i.translate(g,I),i.scale(1,a.series.pie.tilt);for(var f=0;f<w.length;++f)o(w[f].series);y(i),i.restore();function o(t){t.angle<=0||isNaN(t.angle)||(i.fillStyle="rgba(255, 255, 255, "+a.series.pie.highlight.opacity+")",i.beginPath(),Math.abs(t.angle-Math.PI*2)>1e-9&&i.moveTo(0,0),i.arc(0,0,h,t.startAngle,t.startAngle+t.angle/2,!1),i.arc(0,0,h,t.startAngle+t.angle/2,t.startAngle+t.angle,!1),i.closePath(),i.fill())}}}var V={series:{pie:{show:!1,radius:"auto",innerRadius:0,startAngle:3/2,tilt:1,shadow:{left:5,top:15,alpha:.02},offset:{top:0,left:"auto"},stroke:{color:"#fff",width:1},label:{show:"auto",formatter:function(d,N){return"<div style='font-size:x-small;text-align:center;padding:2px;color:"+N.color+";'>"+d+"<br/>"+Math.round(N.percent)+"%</div>"},radius:1,background:{color:null,opacity:0},threshold:0},combine:{threshold:-1,color:null,label:"Other"},highlight:{opacity:.5}}}};S.plot.plugins.push({init:U,options:V,name:"pie",version:"1.1"})})(jQuery);
